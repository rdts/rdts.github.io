<html lang="en">
    <head>
        <meta charset=utf-8/>
		<TITLE> surfline cam viewer </TITLE>
		<style>
			#camcontainer { position: relative; width: 100%; padding-bottom: 56%; }
			#camframe { position: absolute; left: 0px; top: 0px; width: 100%; height: 100% }
			#camselect { font-weight:bold; font-size:14px; }
			#message {font-weight:bold; font-size:14px; }
		</style>
		
    </head>
	
    <body>
		<select id="camselect" onchange="changecam()" > <--- this is function in .js
			<option value="hbss"> HB Pier South </option>
			<option value="elporto"> El Porto </option>
			<option value="elportoclose"> El Porto Close-Up </option>
			<option value="elportofixed"> El Porto North </option>
			<!-- <option value="4203"> County Line </option> -->
			<!-- <option value="135846"> County Line Overview </option> -->
			<!-- <option value="4223"> HB Pier North </option> -->
			<option value="cstreetov"> C Street </option>
			<option value="venturapoint"> Ventura Point </option>
			<option value="malibu"> Malibu </option>
			<option value="topangaclose"> Topanga </option>
			<option value="zumaov"> Zuma </option>
			<option value="saltcreek"> Salt Creek </option>
			<option value="tstreet"> T Street </option>
			<option value="morro"> Morro Bay </option>
			<!-- <option value="4188"> Steamer Lane </option> -->
			<!-- <option value="4152"> Mavericks </option> -->
			<!-- <option value="4750"> Pipeline </option> -->
			<option value="pipelineov"> Pipeline Overview </option>
			<!-- <option value="4751"> Backdoor </option> -->
			<!-- <option value="133984"> Backdoor Overview </option> -->
			<option value="sunsetpoint"> Sunset </option>
			<option value="waimea"> Waimea Bay </option>
			<option value="waimeabaysb"> Waimea Overview </option>
		</select>
		<br>
		<div id="message"> </div>
		<!-- <iframe id="camframe" class="video" allow="autoplay" > -->
			<video id="camcontainer" autoplay=""  muted="muted"/>
		<!-- </iframe> -->
    </body>	


	<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>	

	<script type="text/javascript">
		window.onload = start;
		video = document.getElementById('camcontainer');
		message = document.getElementById('message');
		hls = null;
		cammenu = document.getElementById('camselect');

		function changecam() {
			var cammenu = document.getElementById('camselect');
			var camname = cammenu.options[cammenu.selectedIndex].value;
			loadcam(camname);
		}
		
		function loadcam(camname){
			vidurl = "https://cams.cdn-surfline.com/cdn-wc/wc-" + camname + "/chunklist.m3u8";
			message.innerText = "";
			if(Hls.isSupported()) {
				if(hls!=null) {
					console.log("destroying hls");
					hls.destroy();
				}
				console.log("loading " + vidurl);
				hls = new Hls();
				hls.config.xhrSetup = function(xhr, url) {
					//xhr.withCredentials = true;
					//xhr.setRequestHeader('Content-Type', 'application/vnd.apple.mpegurl'); 
					//xhr.setRequestHeader("X-Requested-With", "XMLHttpRequest"); 
					//xhr.setRequestHeader("origin", window.location.origin);
					console.log("header");
				}
				hls.attachMedia(video);
				hls.on(Hls.Events.MEDIA_ATTACHED, function () {
					console.log("video and hls.js are now bound together !");
					hls.loadSource(vidurl);
					hls.on(Hls.Events.MANIFEST_PARSED, function (event, data) {
					  console.log("manifest loaded, found " + data.levels.length + " quality level");
					  video.play();
					});
				});
				hls.on(Hls.Events.ERROR, function (event, data) {
					console.log("hls error:  " + data.details);
					message.innerText = "hls error:  " + data.details;
					console.log(event);
					console.log(data);
				});
			} else {
			  message.innerText = "Error:  HLS not supported";
			}
		}
		
		function start(){		
			var urlParams = new URLSearchParams(window.location.search);
			if ( urlParams.get("id")!=null && RegExp(/^[a-z]+$/).test(urlParams.get("id")) ) {
				camname = urlParams.get("id");  //if url includes "?id=###" then load this camera id
			} else {
				camname = cammenu.options[cammenu.selectedIndex].value;  //load the first listed camera
			}
			loadcam(camname);
		};
		
	</script>
	
	
</html>